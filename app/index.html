<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Scalr Farm Migrator</title>
  <link type="image/x-icon" href="static/favicon.ico" rel="shortcut icon" />
</head>
<body ng-app="ScalrStorefront">
  <div class="container" ng-controller="StorefrontController">

    <div class="header">
      <h1>Scalr Storefront</h1>
      <p>A simplified user experience for Scalr</p>
    </div>

    <div class="auth">
      <h2>Please enter your API credentials to get started</h2>
      <form id="loginForm">
        <label for="auth-server">
          <span class="auth-label">Server</span>
          <input required id="auth-server" class="auth-input" name="server" ng-model="apiSettings.apiUrl" type="text"/>
        </label>
        <br/>
        <label for="auth-keyid">
          <span class="auth-label">API Key ID</span>
          <input required id="auth-keyid" class="auth-input" name="keyid" ng-model="apiSettings.keyId" placeholder="Required" type="text"/>
        </label>
        <br/>
        <label for="auth-secret">
          <span class="auth-label">Secret Key</span>
          <input required id="auth-secret" class="auth-input" name="secret" ng-model="apiSettings.secretKey" placeholder="Required" type="password"/>
        </label>
        <br/> 
        <label for="auth-envid">
          <span class="auth-label">Environment ID</span>
          <input required id="auth-envid" class="auth-input" name="envid" ng-model="apiSettings.envId" placeholder="Required" type="text"/>
        </label>
        <br/>
        <div class="button-container">
          <button type="button" ng-click="apiSettingsDone()" class="auth-button" id="auth-button-done">Done</button>
          <button type="button" ng-click="saveApiSettings()" class="auth-button store-dependant" id="auth-button-save">Save credentials locally</button>
          <button type="button" ng-click="clearApiSettings()" class="auth-button store-dependant" id="auth-button-unsave">Delete saved credentials</button>
        </div>
        <p>Saving your credentials in your browser allows you not to have to fill them in every time you visit this page</p>
        <p>Saving credentials locally is not available because your browser doesn't support local storage</p>
      </form>
    </div>

    <div class="farms">
      <div class="running-farms">
        <h2>Your Farms</h2>
        <div ng-hide="myFarms.length > 0"><p>You don't have any Farm running at the moment! Launch one from the selection below.</p></div>
        <ul ng-hide="myFarms.length == 0" class="ng-hide">
         <li ng-repeat="farm in myFarms" class="running-farm-desc">
          <img class="running-farm-logo" src="{{farm.description.logo}}"/>
          <p>{{farm.name}}<br/><a href="#" ng-click="showDetails(farm);">Details</a></p>
          <div class="running-farm-{{farm.id}}-details" ng-show="farm.showDetails">
            <p>Servers:</p>
            <table>
              <thead>
                <tr>
                  <td>Hostname</td>
                  <td>Status</td>
                  <td>Platform</td>
                  <td>Public IP</td>
                  <td>Private IP</td>
                  <td>Launched</td>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="s in farm.servers">
                  <td>{{s.hostname}}</td>
                  <td>{{s.status}}</td>
                  <td>{{s.cloudPlatform}}</td>
                  <td>{{s.publicIp[0]}}</td>
                  <td>{{s.privateIp[0]}}</td>
                  <td>{{s.launched}}</td>
                </tr>
              </tbody>
            </table>
          </div>
         </li>
        </ul>
      </div>

      <div class="available-farms">
        <h2>Available Farms</h2>
        <div ng-hide="availableFarmSets.length > 0">
          <p>It looks like no Farms are available in your environment! Ask your administrator to add template Farms.</p>
        </div>
        <div ng-hide="availableFarmSets.length == 0" class="ng-hide">
        <p>Select a Farm to launch:</p>
        <ul>
         <li ng-repeat="farmSet in availableFarmSets" class="available-farm-desc">
          <img class="available-farm-logo" src="{{farmSet.logo}}"/>
          <p>Name: {{ farmSet.name }}<br/>
          Description: {{ farmSet.description }}<br/>
          <a href="#" ng-click="farmSet.show_launch = ! farmSet.show_launch">Configure launch</a></p>
          <div class="available-farm-launch" id="farm-{{farm.id}}-launch" ng-show="farmSet.show_launch">
            <form>
              <label for="platform-select-{{farmSet.selected}}">
              Platform:
              <select id="platform-select-{{farmSet.selected}}" ng-model="farmSet.selected" ng-options="k as v.platform for (k,v) in farmSet.farms">
              </select>
              </label>
              <p>Estimated price: {{farmSet.farms[farmSet.selected].description.dailyPrice}}/day</p>
              <label for="launch-farm-{{farmSet.selected}}-name">
                Name:
                <input required id="launch-farm-{{farmSet.selected}}-name" class="launch-farm-input" ng-model="farmSet.farms[farmSet.selected].new_name" type="text"/>
              </label>
              <!-- TODO: Farm scheduling -->
              <div id="button-container">
                <button type="button" class="auth-button" id="button-farm-{{farmSet.selected}}-done" ng-click="cloneAndLaunch(farmSet.farms[farmSet.selected]);">Done</button>
                <button type="button" class="auth-button" id="button-farm-{{farmSet.selected}}-cancel" ng-click="">Cancel</button>
              </div>
            </form>
          </div>
         </li>
        </ul>
        </div>
      </div>

    </div>

  </div>

  <script src="https://code.jquery.com/jquery-1.12.3.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.16/angular.min.js"></script>
  <script src="/static/angular-local-storage.min.js"></script>
  <script src="/static/hmac-sha256.js"></script>
  <script src="/static/enc-base64-min.js"></script>
  <script src="/static/scalr-api.js"></script>
  <script src="/storefront.js"></script>
</body>
</html>